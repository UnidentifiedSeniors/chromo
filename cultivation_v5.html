<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BioLog Terminal v5.0</title>
  <link rel="icon" href="website_logo.ico" type="image/x-icon">
  <style>
    :root {
      --bg: #000; --fg: #0f0;
      --panel-bg: #111; --btn-bg: #111;
      --btn-hover: #222; --border: #0f0;
    }
    .light-theme {
      --bg: #fff; --fg: #000;
      --panel-bg: #f4f4f4; --btn-bg: #eee;
      --btn-hover: #ddd; --border: #000;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      background: var(--bg); color: var(--fg);
      font-family: monospace;
      display: flex; flex-direction: column;
      min-height: 100vh;
    }
    #main {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 300px;
      grid-gap: 20px;
      width: 90%; max-width: 1000px;
      margin: 20px auto;
    }
    h2 {
      grid-column: 1 / -1;
      text-align: center; font-size: 2em;
      margin: 0 0 10px;
    }
    .panel {
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 15px;
    }
    .panel p, .panel strong {
      font-size: 1.1em; margin: 8px 0;
    }
    button {
      background: var(--btn-bg); color: var(--fg);
      border: 1px solid var(--border);
      padding: 10px 20px; margin: 5px;
      font-size: 1em; border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background: var(--btn-hover); }
    #portrait img {
      width: 100%; max-width: 250px;
      border: 1px solid var(--border);
      border-radius: 6px; margin-bottom: 10px;
    }
    #lootBackdrop {
      position: relative;
      width: 80%;
      max-width: 600px;
      margin: auto;
      text-align: left;
    }
    #lootLog p {
      margin: 6px 0;
    }
    #lootBackdrop button {
      display: block;
      margin: 0 auto;
    }

    /* Sparring overlay */
    #enemySection {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      display: none; align-items: center;
      justify-content: center; z-index: 1000;
    }
    #arenaBackdrop {
      background: var(--panel-bg);
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 20px; text-align: center;
      width: 80%; max-width: 700px;
    }
    #enemyImg { max-width: 150px; margin-bottom: 10px; }
    #enemyInfo h3 {
      font-size: 1.4em; margin: 10px 0;
    }
    #enemyHpBar 
    {
        position: relative;
        overflow: hidden;          /* clip inner fill */
        border-radius: 4px;        /* round corners if you like */
        box-sizing: border-box;    /* include the 1px border in its width */
        border: 1px solid var(--border);
        width: 100%; height: 20px;
        background: #333;
        }
        #enemyHpFill {
        height: 100%;
        background: #f00;
        width: 100%;               /* will shrink via JS */
        transition: width 0.3s ease;
        box-sizing: border-box;    /* so it never bleeds out */
        }

    #fightNotify {
      color: #ff0; font-size: 1.2em;
      min-height: 30px; margin-bottom: 15px;
    }
    #fightActions button {
      padding: 10px 24px; margin: 0 10px;
    }
    /* Footer buttons */
    #footer {
      display: flex; justify-content: center;
      padding: 10px; background: var(--panel-bg);
      border-top: 1px solid var(--border);
    }
    #footer button { margin: 0 10px; }
  </style>
</head>
<body>
  <div id="main">
    <h2>BioLog Terminal Interface v5.0</h2>

    <!-- Left Column -->
    <div>
      <div class="panel">
        <p>üé≤ Spins: <strong id="spinRolls">3</strong></p>
        <button onclick="rollRace()">Roll Race</button>
        <button onclick="rollClan()">Roll Clan</button>
        <button onclick="rollPotential()">Roll Potential</button>
      </div>
      <div class="panel">
        <p><strong>Race:</strong> <span id="race">‚Äì</span></p>
        <p><strong>Clan:</strong> <span id="clan">‚Äì</span></p>
        <p><strong>Potential √ó</strong><span id="potential">1</span></p>
      </div>
      <div class="panel">
        <p><strong>Realm:</strong> <span id="realm">Body Tempering</span></p>
        <p><strong>Benefit:</strong> <span id="benefit">‚Äì</span></p>
      </div>
      <div class="panel">
        <p><strong>HP:</strong> <span id="hp">100</span>/<span id="maxHp">100</span></p>
        <p><strong>Qi:</strong> <span id="qi">0</span></p>
        <p><strong>STR:</strong> <span id="str">0</span></p>
        <p><strong>EXP:</strong> <span id="exp">0</span></p>
      </div>
    </div>

    <!-- Right Column -->
    <div id="portrait">
      <img src="dormant_person.png" alt="Cultivator Portrait">
      <div>
        <button onclick="meditate()">Meditate</button>
        <button onclick="train()">Train</button>
        <button onclick="breakthrough()">Breakthrough</button>
        <button onclick="enterFight()">Fight</button>
      </div>
      <div class="panel">
        <p><strong>Inventory:</strong></p>
        <ul id="invList"></ul>
      </div>
    </div>
  </div>

  <!-- Sparring Overlay -->
  <div id="enemySection">
    <div id="arenaBackdrop">
      <h3>üõ°Ô∏è Arena</h3>
      <img id="enemyImg" src="enemy.png" alt="Enemy">
      <div id="enemyInfo">
        <h3 id="enemyName">Enemy</h3>
        <div id="enemyHpBar"><div id="enemyHpFill"></div></div>
      </div>
      <div id="fightNotify"></div>
      <div id="fightActions">
        <button id="attackBtn" onclick="attack()">Attack</button>
        <button id="leaveBtn" onclick="leaveFight()">Flee</button>
      </div>
    </div>
    <!-- Loot Log: hidden by default -->
    <div id="lootBackdrop" class="panel" style="display:none; max-height:80vh; overflow:auto;">
      <h3>üéÅ Loot & Rewards</h3>
      <div id="lootLog" style="max-height:60vh; overflow-y:auto; padding:10px; border:1px solid var(--border); margin-bottom:10px;">
        <!-- items will be appended here -->
      </div>
      <button onclick="closeLoot()">Close</button>
    </div>
  </div>

  <!-- Footer: Theme & Admin -->
  <div id="footer">
    <button id="themeToggle">Switch Theme</button>
    <button onclick="toggleAdmin()">Admin</button>
  </div>

<script>
// Data model
let data = {
  qi: 0, str: 0, exp: 0,
  hp: 100, maxHp: 100,
  race: "", clan: "", potential: 1,
  spins: 3, unlimitedSpins: false,
  inFight: false, xpMulti: 1, 
  realmIndex: 0, subLevel: 1, meditating: false,
  training: false
};

// Races and clans
const races = {
  "Human": { tooltip: "Balanced.", str:1, qi:1 },
  "Dragonkin": { tooltip:"+STR gain, -Qi regen", str:1.2, qi:0.8 },
  "Phantom": { tooltip:"+Qi regen, -HP", qi:1.3, hp:0.85 },
  "Beastkin": { tooltip:"+HP & STR, slower Qi gain", hp:1.2, str:1.2, qi:0.8 }
};
const clans = {
  "Sun Clan": { tooltip:"+20% EXP gain", exp:1.2 },
  "Ice Vein": { tooltip:"Auto heal 1 HP every 10s" },
  "Thunder Hall": { tooltip:"+10% Crit chance", crit:0.1 },
  "Jade Root": { tooltip:"+20% Loot Quality", loot:1.2 }
};
const enemies = [
  {name:"Rogue Cultivator", level:1, hp:30, str:5},
  {name:"Bandit Monk", level:2, hp:50, str:8},
  {name:"Dark Disciple", level:3, hp:80, str:12}
];

// Realm definitions
const realmNames = [
  'Body Tempering','Qi Refining','Foundation Establishment','Core Formation','Golden Core',
  'Nascent Soul','Soul Transformation','Void Core','Spirit Severing','Ascension',
  'Immortal Foundation','Sky Immortal','Celestial Core','Saint Origin','True Deity',
  'Aether Monarch','Chaos Embryo','Primordial Saint','Void Immortal','Endless Paragon'
];
const realmBenefits = {};
for(let lvl=1; lvl<=100; lvl++){
  realmBenefits[lvl] = (lvl % 5 === 0)
    ? `Breakthrough bonus: +${(lvl/5)*2}% all stats`
    : `Buff: +${lvl}% EXP per train`;
}

// after you build realmBenefits‚Ä¶
const realmBuffs = {};  
for (let lvl = 1; lvl <= 100; lvl++) {
  if (lvl % 5 === 0) {
    // every 5th level gives a breakthrough bonus: +2% √ó (lvl/5)
    realmBuffs[lvl] = (lvl / 5) * 0.02;  // e.g. level 10 ‚Üí 0.04 = +4%
  } else {
    // other levels give +lvl% EXP per train
    realmBuffs[lvl] = lvl * 0.01;        // e.g. level 7 ‚Üí 0.07 = +7%
  }
}

const tiers = [
  {range:[0,3],color:'#888'},
  {range:[4,7],color:'#0c6'},
  {range:[8,11],color:'#39f'},
  {range:[12,15],color:'#93f'},
  {range:[16,19],color:'#fc0'}
];

// Utility functions
function roman(n){ return ['','I','II','III','IV','V'][n] || ''; }
function totalLevel(){ return data.realmIndex*5 + data.subLevel; }
function getRealmColor(idx){
  for(let t of tiers) if(idx>=t.range[0] && idx<=t.range[1]) return t.color;
  return '#fff';
}

function log(msg) {
  console.log('[LOG]', msg);
}


// Update UI
function updateUI()
{   
  if(data.qi < 0){data.qi = 0}
  if(data.str < 0){data.str = 0}
  
  document.getElementById('spinRolls').innerText = data.unlimitedSpins?'‚àû':data.spins;
  document.getElementById('race').innerText = data.race;
  document.getElementById('race').dataset.tooltip = races[data.race]?.tooltip || '';
  document.getElementById('clan').innerText = data.clan;
  document.getElementById('clan').dataset.tooltip = clans[data.clan]?.tooltip || '';
  document.getElementById('potential').innerText = (1 + (data.potential/100)*4).toFixed(2);

  const realmText = realmNames[data.realmIndex] + ' ' + roman(data.subLevel);
  document.getElementById('realm').innerText = realmText;
  const lvl = totalLevel();
  document.getElementById('benefit').innerText = realmBenefits[lvl];
  document.getElementById('benefit').dataset.tooltip = `Level ${lvl} Benefit`;

  document.getElementById('hp').innerText = Math.floor(data.hp);
  document.getElementById('maxHp').innerText = data.maxHp;
  document.getElementById('qi').innerText = Math.floor(data.qi);
  document.getElementById('str').innerText = Math.floor(data.str);
  document.getElementById('exp').innerText = Math.floor(data.exp);

  const inv = Object.entries(data.inventory || {}).map(([k,v])=>k+':'+v).join(' | ');
  document.getElementById('inventory').innerText = 'Inventory: ' + inv;

}

// Spin functions
function rollRace(){
  if(!data.unlimitedSpins && data.spins<=0){alert('No spins left');return;}
  if(!data.unlimitedSpins) data.spins--;
  const keys = Object.keys(races);
  data.race = keys[Math.floor(Math.random()*keys.length)];
  if(races[data.race].hp) data.maxHp = 100 * races[data.race].hp;
  updateUI();
}
function rollClan(){
  if(!data.unlimitedSpins && data.spins<=0){alert('No spins left');return;}
  if(!data.unlimitedSpins) data.spins--;
  const keys = Object.keys(clans);
  data.clan = keys[Math.floor(Math.random()*keys.length)];
  updateUI();
}
function rollPotential(){
  if(!data.unlimitedSpins && data.spins<=0){alert('No spins left');return;}
  if(!data.unlimitedSpins) data.spins--;
  data.potential = Math.floor(Math.random()*100)+1;
  updateUI();
}

// Auto-meditate & auto-train system
let medInterval = null;
let trainInterval = null;

// State flags
data.meditating = false;
data.training    = false;

// Auto‚Äëtick functions
function meditateTick() {
  const lvl = totalLevel();                   // compute realm index √ó5 + subLevel
  const buff = realmBuffs[lvl] || 0;          // e.g. 0.07 for +7%
  const raceQi  = races[data.race]?.qi  || 1; // race modifier
  const potMult = 1 + (data.potential / 100) * 4;
  // base gain = 1, then √ópotential, √órace, √ó(1 + realm buff)
  const gain = 1 * potMult * raceQi * (1 + buff);
  data.qi += gain;
  log(`Meditating... +${gain.toFixed(1)} Qi (${(buff*100).toFixed(0)}% realm buff)`);
  updateUI();
}


function trainTick() {
  if (data.hp < data.maxHp * 0.01) {
    alert("Need at least 1% HP to train");
    stopTraining();
    return;
  }
  if (data.qi <= 0) return;

  data.qi--;  // consume Qi

  const lvl      = totalLevel();
  const buff     = realmBuffs[lvl] || 0;
  const potMult  = 1 + (data.potential / 100) * 4;
  const raceStr  = races[data.race]?.str || 1;
  const clanExp  = clans[data.clan]?.exp || 1;

  // Strength gain: base 2 √ó potential √ó race modifier
  const strGain = 2 * potMult * raceStr * (1 + (lvl % 5 === 0 ? buff : 0));
  data.str += strGain;

  // EXP gain: base 1 √ó potential √ó clan modifier √ó (1 + realmBuff)
  const expGain = 1 * potMult * clanExp * (1 + buff);
  data.exp += expGain;

  data.hp -= 2;  // training costs HP

  log(`Training‚Ä¶ +${strGain.toFixed(1)} STR, +${expGain.toFixed(1)} EXP ` +
      `(-1 Qi, -2 HP, +${(buff*100).toFixed(0)}% realm buff)`);
  updateUI();
}


// Helpers to stop each
function stopMeditating() {
  clearInterval(medInterval);
  medInterval = null;
  data.meditating = false;
}
function stopTraining() {
  clearInterval(trainInterval);
  trainInterval = null;
  data.training = false;
}

// Toggle Meditate
function meditate() {
  if (data.inFight) {data.meditating = false; return}                          // never in fight
  if (data.meditating) stopMeditating();      // already on ‚Üí turn off
  
  // switch if already training and not admin
  if (data.training && !data.unlimitedSpins) stopTraining();
  
  // start meditating
  data.meditating = true;
  medInterval = setInterval(meditateTick, 700);
}

// Toggle Train
function train() {
  if (data.inFight) {data.training = false; return}                         // never in fight
  if (data.training) stopTraining();          // already on ‚Üí turn off
  
  // switch if already meditating and not admin
  if (data.meditating && !data.unlimitedSpins) stopMeditating();
  
  // start training
  data.training = true;
  trainInterval = setInterval(trainTick, 1000);
}


// Breakthrough
function breakthrough(){
  if(data.exp < 100){alert('Need 100 EXP'); return;}
  data.exp -= 100;
  if(data.subLevel < 5) data.subLevel++;
  else {data.subLevel=1; if(data.realmIndex<19) data.realmIndex++;}
  data.realmColor = getRealmColor(data.realmIndex);
  alert('Advanced to ' + realmNames[data.realmIndex] + ' ' + roman(data.subLevel));
  updateUI();
}

// Fight system
function enterFight()
{
  const sec = document.getElementById('enemySection');
  sec.style.display = 'flex';
  data.inFight = true;

  stopMeditating();
  stopTraining();
  clearInterval(medInterval); clearInterval(trainInterval);

   const enemy = { ...enemies[Math.floor(Math.random()*enemies.length)] };
  enemy.maxHp = enemy.hp;           // ‚Üê store original HP
  data.currentEnemy = enemy;

  // Populate UI
  document.getElementById('enemyName').innerText =
    `${enemy.name} (Lv${enemy.level})`;
  document.getElementById('enemyHpFill').style.width = '100%';
  document.getElementById('fightNotify').innerText = '';
  
  // show the overlay
  document.getElementById('enemySection').style.display = 'flex';
}

function attack() {
  const enemy = data.currentEnemy;
  const dmg = Math.floor(data.str * (1 + (data.potential/100)*4));
  enemy.hp -= dmg;

  // Update HP‚Äêbar & notify
  const pct = Math.max(0, enemy.hp / enemy.maxHp * 100);
  document.getElementById('enemyHpFill').style.width = pct + '%';
  document.getElementById('fightNotify').innerText = `You strike for ${dmg}!`;

  if (enemy.hp > 0) {
    // Enemy retaliates‚Ä¶
    setTimeout(() => {
      data.hp -= enemy.str;
      document.getElementById('fightNotify').innerText =
        `Enemy hits you for ${enemy.str}!`;
      updateUI();  // safe to update main HUD here
      if (data.hp <= 0) {
        document.getElementById('fightNotify').innerText = 'üíÄ You have fallen...';
        setTimeout(() => location.reload(), 1500);
      }
    }, 500);
    return;
  }

  // === Victory! ===
  enemy.hp = 0;
  document.getElementById('enemyHpFill').style.width = '0%';

  // Compute rewards
  const rewards = [];
  const expGain = Math.floor(20 * (clans[data.clan]?.exp || 1));
  data.exp += expGain;
  rewards.push(`EXP +${expGain}`);

  if (Math.random() < 0.5) {
    const item = getRandomLoot();
    data.inventory[item] = (data.inventory[item]||0) + 1;
    rewards.push(`Loot: ${item}`);
  }

  // Immediately switch to loot log
  setTimeout(() => {
    showLootLog(rewards);
  }, 300);
}

function leaveFight() {
  document.getElementById('enemySection').style.display = 'none';
  data.inFight = false;
  updateUI();
}

function showLootLog(rewards) {
  // Hide fight UI
  document.getElementById('arenaBackdrop').style.display = 'none';

  // Populate the scrollable log
  const log = document.getElementById('lootLog');
  log.innerHTML = '';
  rewards.forEach(r => {
    const p = document.createElement('p');
    p.textContent = r;
    log.appendChild(p);
  });

  // Show loot panel
  document.getElementById('lootBackdrop').style.display = 'block';
}

function closeLoot() {
  // Hide entire overlay
  document.getElementById('enemySection').style.display = 'none';
  data.inFight = false;

  // Reset panels for next fight
  document.getElementById('arenaBackdrop').style.display = 'block';
  document.getElementById('lootBackdrop').style.display = 'none';

  // Now update the main HUD to reflect your EXP/HP/inventory changes
  updateUI();
}


// HP regen
setInterval(()=>{
  if(data.inFight)return;
  if(data.hp < data.maxHp){
    data.hp += data.maxHp * 0.05;
    if(data.hp > data.maxHp) data.hp = data.maxHp;
    updateUI();
  }
},2500);

// Admin toggle
function toggleAdmin(){
  const pw = prompt('Admin Password:');
  if(pw === 'java'){data.unlimitedSpins=true;alert('Unlimited spins!'); updateUI();}
  else alert('Wrong password');
}

const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-theme');
      themeToggle.textContent = document.body.classList.contains('light-theme')
        ? 'Switch to Dark Theme'
        : 'Switch Theme';
    });
    
// Initialize UI
updateUI();
</script>
</body>
</html>
